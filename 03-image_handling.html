<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Data Handling: Image Handling</title><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="stylesheet" type="text/css" href="assets/styles.css"><script src="assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [ ['$','$'], ['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png"><link rel="manifest" href="site.webmanifest"><link rel="mask-icon" href="safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" content="#ffffff"></head><body>
    <header id="top" class="navbar navbar-expand-md navbar-light bg-white top-nav l2d"><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-6">
      <div class="large-logo"><img alt="l2d" src="assets/images/l2d-logo.svg"></div>
    </div>
    <div class="selector-container ">
      
      <div class="dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Learner View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li><button class="dropdown-item" type="button" onclick="window.location.href='instructor/03-image_handling.html';">Instructor View</button></li>
        </ul></div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl navbar-light bg-white bottom-nav l2d" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="l2d" src="assets/images/l2d-logo-sm.svg"></div>
    <div class="lesson-title-md">
      Data Handling
    </div>
    <div class="search-icon-sm">
      <i role="img" aria-label="search button" data-feather="search"></i>
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0"><li class="nav-item">
          <span class="lesson-title">
            Data Handling
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="reference.html#glossary">Glossary</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="profiles.html">Learner Profiles</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown"></ul></li>
      </ul></div>
    <form class="d-flex col-md-2 search-form">
      <input class="form-control me-2 searchbox" type="search" placeholder="Search" aria-label="Search"><button class="btn btn-outline-success tablet-search-button" type="submit"><i class="search-icon" data-feather="search" role="img" aria-label="search button"></i></button>
    </form>
  </div><!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Data Handling
</div>

<aside class="col-md-12 lesson-progress"><div style="width: 100%" class="percentage">
    100%
  </div>
  <div class="progress l2d">
    <div class="progress-bar l2d" role="progressbar" style="width: 100%" aria-valuenow="100" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
  <div id="sidebar-col" class="col-lg-4">
    <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle"><i class="search-icon" data-feather="x" role="img"></i></button>
        <div class="sidebar-inner">
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Learner View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="instructor/03-image_handling.html">Instructor View</a>
                      </div>
                    </div>
                  </div><!--/div.accordion-item-->
                </div><!--/div.accordion-flush-->
              </div><!--div.sidenav-view-selector -->
            </div><!--/div.col -->
      
            <hr></div><!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  CHAPTERS
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Setup</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="01-data_frames_1.html">1. Data Frames - Part 1</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="02-data_frames_2.html">2. Data Frames - Part 2</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlushcurrent">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-headingcurrent">
      <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapsecurrent" aria-expanded="true" aria-controls="flush-collapsecurrent">
        <span class="visually-hidden">Current Chapter</span>
        <span class="current-chapter">
        Image Handling
        </span>
      </button>
    </div><!--/div.accordion-header-->
        
    <div id="flush-collapsecurrent" class="accordion-collapse collapse show" aria-labelledby="flush-headingcurrent" data-bs-parent="#accordionFlushcurrent">
      <div class="accordion-body">
        <ul><li><a href="#challenge">Challenge</a></li>
<li><a href="#work-through-example">Work Through Example</a></li>
<li><a href="#exercises-1">Exercises</a></li>
        </ul></div><!--/div.accordion-body-->
    </div><!--/div.accordion-collapse-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width"><div class="accordion accordion-flush resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul></ul></div>
                </div>
              </div>
            </div>

            <a href="aio.html">See all in one page</a>

            <hr class="d-none d-sm-block d-md-none"><div class="d-grid gap-1">
            
            </div>
          </div><!-- /div.accordion -->
        </div><!-- /div.sidebar-inner -->
      </nav></div><!-- /div.sidebar -->
  </div><!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-instructor.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <nav class="lesson-content mx-md-4" aria-label="Previous and Next Chapter"><!-- content for small screens --><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="02-data_frames_2.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="index.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="02-data_frames_2.html" rel="prev"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous: Data Frames - Part 2</a>
        <a class="chapter-link float-end" href="index.html" rel="next">Next... <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <hr></nav><main id="main-content" class="main-content"><div class="container lesson-content">
        <h1>Image Handling</h1>
        <p> Last updated on 2022-06-23 | <a href="https://github.com/carpentries/workbench-template-rmd/edit/main/episodes/03-image_handling.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
        <div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right"> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>

        

<p><a href="03-image_handling.md.pdf"><strong>Download Chapter
pdf</strong></a></p>
<p><a href="03-image_handling_2.ipynb"><strong>Download Chapter notebook
(ipynb)</strong></a></p>
<p><a href="https://docs.google.com/forms/d/e/1FAIpQLSdr0capF7jloJhPH3Pki1B3LZoKOG16poOpuVJ7SL2LkwLHQA/viewform?pli=1" class="external-link"><span style="color: rgb(255, 0, 0);"><strong>Mandatory Lesson Feedback
Survey</strong></span></a></p>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul><li>How to read and process images in Python?</li>
<li>How is an image mask created?</li>
<li>What are colour channels in images?</li>
<li>Why dealing with big images is tricky?</li>
</ul></div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul><li>Understanding 2-dimensional greyscale images.</li>
<li>Learning image masking.</li>
<li>2-dimensional colour images, colour channels</li>
<li>Decreasing memory load</li>
</ul></div>
</div>
</div>
</div>
</div>
<div id="prereq1" class="callout prereq">
<div class="callout-square">
<i class="callout-icon" data-feather="check"></i>
</div>
<div id="prerequisites" class="callout-inner">
<h3 class="callout-title">Prerequisites</h3>
<div class="callout-content">
<ul><li>Numpy arrays</li>
<li>Plots and subplots with matplotlib</li>
</ul></div>
</div>
</div>
<div id="callout1" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="exercises" class="callout-inner">
<h3 class="callout-title">Exercises</h3>
<div class="callout-content">
<p style="text-align: justify;">
This lesson has no explicit exercises. At each step, use images of your
own choice to practice. There are many image file formats, different
colour schemes etc for which you can try to find similar or analogous
solutions.
</p>
</div>
</div>
</div>
<section id="challenge"><h2 class="section-heading">Challenge</h2>
<hr class="half-width"><div class="section level3">
<h3 id="reading-and-processing-images"><strong>Reading and Processing Images</strong><a class="anchor" aria-label="anchor" href="#reading-and-processing-images"></a></h3>
<p style="text-align: justify;">
In biology, we often deal with images, for example from microscopy and
different medical imaging modalities. In many cases, we wish to extract
some quantitative information from these images. The focus of this
lesson is to read and process images in Python. This includes:
</p>
<ul><li>Working with 2-dimensional greyscale images</li>
<li>Creating and appyling binary image masks</li>
<li>Working with 2-dimensional colour images, and interpreting colour
channels</li>
<li>Decreasing the memory for further processing by reducing resolution
or patching</li>
<li>Working with 3-dimensional images</li>
</ul></div>
<div class="section level3">
<h3 id="image-example"><strong>Image Example</strong><a class="anchor" aria-label="anchor" href="#image-example"></a></h3>
<p>The example in <a href="#ratCerebellum">Figure 1</a> is an image from
the cell <a href="http://cellimagelibrary.org/home" class="external-link">image library</a>
with the following description:</p>
<blockquote>
<p>“Midsaggital section of rat cerebellum, captured using confocal
imaging. Section shows inositol trisphosphate receptor (IP3R) labelled
in green, DNA in blue, and synaptophysin in magenta. Honorable Mention,
2010 Olympus BioScapes Digital Imaging Competition®.”</p>
</blockquote>
<p style="text-align: justify;">
We might want to, for example, determine the relative amounts of IP3R,
DNA and synaptophysin in this image. This tutorial will guide you
through some of the steps to get you started with processing images of
all sorts using Python. At the end, you will have the opportunity to
come back to this image example and perform some analysis of your own.
</p>
<figure><img src="fig/rat_cerebellum.jpg" id="ratCerebellum" alt="" class="figure mx-auto d-block"><figcaption>Figure 1: Example image, rat cerebellum</figcaption></figure></div>
</section><section id="work-through-example"><h2 class="section-heading">Work Through Example</h2>
<hr class="half-width"><div class="section level3">
<h3 id="reading-and-plotting-a-2-dimensional-image"><strong>Reading and Plotting a 2-dimensional Image</strong><a class="anchor" aria-label="anchor" href="#reading-and-plotting-a-2-dimensional-image"></a></h3>
<p style="text-align: justify;">
First, we want to read in an image. For this part of the lesson, we use
a histological slice through an axon bundle as an example. We use
matplotlib’s image module, from which we import <code>imread</code> to
store the image in a variable called img. The function
<code>imread</code> can interpret many different image formats,
including jpg, png and tif images.
</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.image <span class="im">import</span> imread</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>img <span class="op">=</span> imread(<span class="st">'fig/axon_slice.jpg'</span>)</span></code></pre>
</div>
<p>We can check what type of variable this is:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">type</span>(img))</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>&lt;class 'numpy.ndarray'&gt;</code></pre>
</div>
<p>This tells us that the image is stored in a Numpy array. We can check
some other properties of this array, for example, what the image
dimensions are.</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(img.shape)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>(2300, 3040)</code></pre>
</div>
<p style="text-align: justify;">
This tells us that our image is composed of 2300 by 3040 data units, or
<em>pixels</em> as we are dealing with an image. It is equivalent to the
image resolution. The array has two dimensions, and so we can expect our
image to be two-dimensional as well. Let us now use matplotlib.pyplot’s
<code>imshow</code> function to plot the image to see what it looks
like. We set the colour map to <code>gray</code> to overwrite the
default colour map.
</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.pyplot <span class="im">import</span> subplots, show</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> subplots(figsize<span class="op">=</span>(<span class="dv">25</span>, <span class="dv">15</span>))</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>ax.imshow(img, cmap<span class="op">=</span><span class="st">'gray'</span>)<span class="op">;</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>show()</span></code></pre>
</div>
<figure><img src="fig/03-image_handling-rendered-unnamed-chunk-4-1.png" width="2400" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p style="text-align: justify;">
<code>imshow</code> has allowed us to plot the Numpy array of our image
data as a picutre. The figure is divided up into a number of pixels, and
each of those pixels is assigned an intensity value stored in the Numpy
array. Let’s have a closer look by selecting a smaller region of our
image and plotting that.
</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.pyplot <span class="im">import</span> subplots, show</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> subplots(figsize<span class="op">=</span>(<span class="dv">25</span>, <span class="dv">15</span>))</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>ax.imshow(img[:<span class="dv">50</span>, :<span class="dv">70</span>], cmap<span class="op">=</span><span class="st">'gray'</span>)<span class="op">;</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>show()</span></code></pre>
</div>
<figure><img src="fig/03-image_handling-rendered-unnamed-chunk-5-3.png" width="2400" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p style="text-align: justify;">
With <code>img[:50, :70]</code> we select the first 50 values from the
first dimension, and the first 70 values from the second dimension.
Thus, the image above shows a very small part of the upper left corner
of our original image. As we are now zoomed in quite close to that
corner, we can easily see the individual pixels here. Let’s take a quick
look at an even smaller section.
</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> subplots(figsize<span class="op">=</span>(<span class="dv">25</span>, <span class="dv">15</span>))</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>ax.imshow(img[:<span class="dv">20</span>, :<span class="dv">15</span>], cmap<span class="op">=</span><span class="st">'gray'</span>)<span class="op">;</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>show()</span></code></pre>
</div>
<figure><img src="fig/03-image_handling-rendered-unnamed-chunk-6-5.png" width="2400" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p style="text-align: justify;">
This is a small section from that same upper left corner. Each square is
a pixel and it has one grey value. So how exactly are the pixel values
assigned? By the numbers stored in the Numpy array, <code>img</code>.
Let us have a look at those values by picking a slice from the array.
</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(img[:<span class="dv">20</span>, :<span class="dv">15</span>])</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[[ 18   9   3   4   4   1   2   7   6   8  10  12  13  14  13]
 [ 14   7   3   4   4   2   2   6   6   7   9  11  12  12  12]
 [  8   3   1   3   5   3   2   4   6   7   8   9  10  10   9]
 [  2   0   0   2   4   4   3   2   6   6   7   8   8   8   8]
 [  0   0   0   1   3   5   3   1   6   6   7   7   8   9  10]
 [  0   0   0   0   2   6   5   0   7   7   7   8   9  11  13]
 [  0   2   1   0   1   6   5   1   8   8   8  10  11  14  17]
 [  1   3   2   0   0   6   6   1   9   9   9  10  13  16  19]
 [  1   0   0   1   4   7   8   8  10  12  15  16  18  20  24]
 [  1   1   1   2   4   7   8   8  14  16  19  22  24  28  33]
 [  4   5   5   6   8  10  12  13  19  22  26  30  34  40  46]
 [  9  11  12  13  14  16  18  21  24  27  32  36  42  49  57]
 [ 12  15  17  18  19  21  25  28  32  34  38  43  49  57  65]
 [ 14  17  21  23  24  26  32  36  43  45  47  51  56  63  72]
 [ 18  23  28  31  31  35  41  47  56  57  58  60  64  70  78]
 [ 24  29  35  38  39  42  50  56  65  65  66  67  69  75  82]
 [ 32  39  40  44  51  48  52  69  77  82  83  80  81  89  94]
 [ 35  43  46  51  58  55  58  74  80  85  88  85  87  94  98]
 [ 38  50  56  61  69  66  67  80  85  90  94  95  97 102 105]
 [ 41  56  64  70  78  76  75  84  90  95 100 104 106 109 111]]</code></pre>
</div>
<p>Each of these numbers corresponds to an intensity in the specified
colourmap. These numbers range from 0 to 255, implying 256 shades of
grey.</p>
<p style="text-align: justify;">
We chose <code>cmap = gray</code>, which assigns darker grey colours to
smaller numbers, and lighter grey colours to higher numbers. However, we
can also pick a colourmap to plot our image, and we can even show a
colourbar to keep track of the intensity values. Matplotlib has a large
number of very nice colourmaps that you can look through <a href="https://matplotlib.org/tutorials/colors/colormaps.html" class="external-link">here</a>.
We show an example of the colourmaps called <code>viridis</code> and
<code>magma</code>:
</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> subplots(nrows<span class="op">=</span><span class="dv">1</span>, ncols<span class="op">=</span><span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">25</span>, <span class="dv">15</span>))</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>p1 <span class="op">=</span> ax[<span class="dv">0</span>].imshow(img[:<span class="dv">20</span>, :<span class="dv">15</span>], cmap<span class="op">=</span><span class="st">'viridis'</span>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>p2 <span class="op">=</span> ax[<span class="dv">1</span>].imshow(img[:<span class="dv">20</span>, :<span class="dv">15</span>], cmap<span class="op">=</span><span class="st">'magma'</span>)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>fig.colorbar(p1, ax<span class="op">=</span>ax[<span class="dv">0</span>])</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>fig.colorbar(p2, ax<span class="op">=</span>ax[<span class="dv">1</span>])<span class="op">;</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>show()</span></code></pre>
</div>
<figure><img src="fig/03-image_handling-rendered-unnamed-chunk-8-7.png" width="2400" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p style="text-align: justify;">
Note, that even though we can plot our greyscale image with colourful
colourschemes, it still does not qualify as a colour image. This is
because colour images will require <strong>three sets</strong> of
intensities for each pixel, not just one as in this example. In the case
above, the number in the array represented a grey value and the colour
was assigned to that grey value by Matplotlib. These represent ‘false’
colours.
</p>
</div>
<div class="section level3">
<h3 id="creating-an-image-mask"><strong>Creating an Image Mask</strong><a class="anchor" aria-label="anchor" href="#creating-an-image-mask"></a></h3>
<p>Now that we know that the images are composed of a set of intensities
that are just numbers in a Numpy array, we can start using these numbers
to process our image.</p>
<p style="text-align: justify;">
As a first approach, we can plot a histogram of the original image
intensities. We use the <code>.flatten()</code> method to turn the
original 2300 x 3040 array into a one-dimensional array with 6,992,000
values. This rearrangement allows the inclusion of an image as a single
column in a matrix or dataframe!
</p>
<p>The histogram plot shows how many of each of the intensities are
found in this image:</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">4</span>))</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>ax.hist(img.flatten(), bins <span class="op">=</span> <span class="dv">50</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">"Pixel intensity"</span>, fontsize<span class="op">=</span><span class="dv">16</span>)<span class="op">;</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>show()</span></code></pre>
</div>
<figure><img src="fig/03-image_handling-rendered-unnamed-chunk-9-9.png" width="960" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
The histogram is a distribution with intensity values mostly between
about 50 and 250.
<p style="text-align: justify;">
The image shows a cut through an axon bundle. Say we are now interested
in the myelin sheath surrounding the axons (the dark rings). We can
create a <strong>mask</strong> that isolates pixels whose intensity
value is below a certain threshold (because darker pixels have lower
intensity values). Everything below this threshold can be assigned to
e.g. 1 (representing True), and everything above will be assigned to 0
(representing False). This is called a binary or Boolean mask.
</p>
<p style="text-align: justify;">
Based on the histogram above, we might try to adjust that threshold
somewhere between 100 and 200. Let’s see what we get with a threshold
set to 125. We first use a conditional statement to create the mask.
Then we apply the mask to the image. As a result we plot both the mask
and the masked image.
</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>threshold <span class="op">=</span> <span class="dv">125</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>mask <span class="op">=</span> img <span class="op">&lt;</span> threshold</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>img_masked <span class="op">=</span> img<span class="op">*</span>mask</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> subplots(nrows<span class="op">=</span><span class="dv">1</span>, ncols<span class="op">=</span><span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">10</span>))</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].imshow(mask, cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_title(<span class="st">'Binary mask'</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].imshow(img_masked, cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_title(<span class="st">'Masked image'</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>show()</span></code></pre>
</div>
<figure><img src="fig/03-image_handling-rendered-unnamed-chunk-10-11.png" width="1920" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p style="text-align: justify;">
The left subplot shows the binary mask itself. White represents values
where our condition is true, and black where our condition is false. The
right image shows the original image after we have applied the binary
mask, i.e. the original pixel intensities in regions where the mask
value is true.
</p>
<p style="text-align: justify;">
Note that “applying the mask” means that the intensities where the
condition is true are left unchanged and the intensities where the
condition is false are multiplied with zero ans therefore set to zero.
</p>
<p>Let’s have a look at the resulting image histograms.</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> subplots(nrows<span class="op">=</span><span class="dv">1</span>, ncols<span class="op">=</span><span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">5</span>))</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].hist(img_masked.flatten(), bins<span class="op">=</span><span class="dv">50</span>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_title(<span class="st">'Histogram of masked image'</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_xlabel(<span class="st">"Pixel intensity"</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].hist(img_masked[img_masked <span class="op">!=</span> <span class="dv">0</span>].flatten(), bins<span class="op">=</span><span class="dv">25</span>)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_title(<span class="st">'Histogram of masked image after zeros are removed'</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_xlabel(<span class="st">"Pixel intensity"</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>show()</span></code></pre>
</div>
<figure><img src="fig/03-image_handling-rendered-unnamed-chunk-11-13.png" width="1920" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p style="text-align: justify;">
On the left we show all the values for the masked image. There is a
large peak at zero, as a large part of the image is masked. On the
right, we show only the noon-zero pizel intensities. We can see that our
mask worked as expected, only values up to 125 are found. This is
because our threshold causes a sharp cut-off at a pixel intensity of
125.
</p>
</div>
<div class="section level3">
<h3 id="colour-images">Colour Images<a class="anchor" aria-label="anchor" href="#colour-images"></a></h3>
<p style="text-align: justify;">
Often we want to work with colour images. So far, our image had a single
intensity value for each pixel. In colour images, we will have three
so-called channels corresponding to red, green and blue intensities. Any
colour will be a composite of the intensity value for each of these
colours. We now show an example with a colour image of the rat
cerebellar cortex. Let us import it and check its shape.
</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>img_col <span class="op">=</span> imread(<span class="st">'fig/rat_brain_low_res.jpg'</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>img_col.shape</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>(929, 1000, 3)</code></pre>
</div>
<p style="text-align: justify;">
Our image array now contains three dimensions. The first two are the
spatial dimensions corresponding to the pixel positions. The last one
contains the three colour channels. So we have three layers of intensity
values on top of each other.
</p>
<p>First, let us plot the whole image.</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> subplots(figsize<span class="op">=</span>(<span class="dv">25</span>, <span class="dv">15</span>))</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>ax.imshow(img_col)<span class="op">;</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>show()</span></code></pre>
</div>
<figure><img src="fig/03-image_handling-rendered-unnamed-chunk-13-15.png" width="2400" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
The sample is labeled for Hoescht stain (blue), the Inositol
trisphosphate (IP3) receptor (green) and Glial fibrillary acidic protein
(GFAP) (red).
<p style="text-align: justify;">
Now we can visualise the three colour channels individually by slicing
the Numpy array. The stack with index 0 corresponds to ‘red’, index 1
corresponds to ‘green’ and index 2 corresponds to ‘blue’:
</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>red_channel   <span class="op">=</span> img_col[:, :, <span class="dv">0</span>]</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>green_channel <span class="op">=</span> img_col[:, :, <span class="dv">1</span>]</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>blue_channel  <span class="op">=</span> img_col[:, :, <span class="dv">2</span>]</span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> subplots(nrows<span class="op">=</span><span class="dv">1</span>, ncols<span class="op">=</span><span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">10</span>))</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>imgplot_red <span class="op">=</span> ax[<span class="dv">0</span>].imshow(red_channel, cmap<span class="op">=</span><span class="st">"Reds"</span>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>imgplot_green <span class="op">=</span> ax[<span class="dv">1</span>].imshow(green_channel, cmap<span class="op">=</span><span class="st">"Greens"</span>)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>imgplot_blue <span class="op">=</span> ax[<span class="dv">2</span>].imshow(blue_channel, cmap<span class="op">=</span><span class="st">"Blues"</span>)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>fig.colorbar(imgplot_red, ax<span class="op">=</span>ax[<span class="dv">0</span>], shrink<span class="op">=</span><span class="fl">0.4</span>)</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>fig.colorbar(imgplot_green, ax<span class="op">=</span>ax[<span class="dv">1</span>], shrink<span class="op">=</span><span class="fl">0.4</span>)</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>fig.colorbar(imgplot_blue, ax<span class="op">=</span>ax[<span class="dv">2</span>], shrink<span class="op">=</span><span class="fl">0.4</span>)<span class="op">;</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>show()</span></code></pre>
</div>
<figure><img src="fig/03-image_handling-rendered-unnamed-chunk-15-17.png" width="1920" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p style="text-align: justify;">
This shows what colour combinations each of the pixels is made up of.
Notice that the intensities go up to 255. This is because RGB (red,
green and blue) colours are defined within the range 0-255. This gives a
total of 16,777,216 possible colour combinations!
</p>
<p>We can plot histograms of each of the colour channels.</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> subplots(nrows<span class="op">=</span><span class="dv">1</span>, ncols<span class="op">=</span><span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">5</span>))</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].hist(red_channel.flatten(), bins<span class="op">=</span><span class="dv">50</span>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_xlabel(<span class="st">"Pixel intensity"</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_xlabel(<span class="st">"Red channel"</span>)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].hist(green_channel.flatten(), bins<span class="op">=</span><span class="dv">50</span>)</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_xlabel(<span class="st">"Pixel intensity"</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_xlabel(<span class="st">"Green channel"</span>)</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">2</span>].hist(blue_channel.flatten(), bins<span class="op">=</span><span class="dv">50</span>)</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">2</span>].set_xlabel(<span class="st">"Pixel intensity"</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">2</span>].set_xlabel(<span class="st">"Blue channel"</span>)</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>show()</span></code></pre>
</div>
<figure><img src="fig/03-image_handling-rendered-unnamed-chunk-16-19.png" width="1920" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure></div>
<div class="section level3">
<h3 id="dealing-with-large-images"><strong>Dealing with Large Images</strong><a class="anchor" aria-label="anchor" href="#dealing-with-large-images"></a></h3>
<p style="text-align: justify;">
Sometimes (or quite often, depending on the field of research), we have
to deal with very large images that are composed of many pixels. It can
be quite difficult to process these images, as they can require a lot of
computer memory when they are processed. We will look at two different
strategies for dealing with this problem: decreasing resolution and
using patches from the original image. We will use the full-resolution
version of the rat brain in the above example.
</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>img_hr <span class="op">=</span> imread(<span class="st">'fig/rat_brain.jpg'</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>img_hr.shape</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in py_call_impl(callable, dots$args, dots$keywords): DecompressionBombError: Image size (324649360 pixels) exceeds limit of 178956970 pixels, could be decompression bomb DOS attack.

Detailed traceback:
  File "&lt;string&gt;", line 1, in &lt;module&gt;
  File "/Users/sabaferdous/.virtualenvs/r-env/lib/python3.10/site-packages/matplotlib/image.py", line 1560, in imread
    with img_open(fname) as image:
  File "/Users/sabaferdous/.virtualenvs/r-env/lib/python3.10/site-packages/PIL/Image.py", line 2994, in open
    im = _open_core(fp, filename, prefix, formats)
  File "/Users/sabaferdous/.virtualenvs/r-env/lib/python3.10/site-packages/PIL/Image.py", line 2981, in _open_core
    _decompression_bomb_check(im.size)
  File "/Users/sabaferdous/.virtualenvs/r-env/lib/python3.10/site-packages/PIL/Image.py", line 2890, in _decompression_bomb_check
    raise DecompressionBombError(</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in py_call_impl(callable, dots$args, dots$keywords): NameError: name 'img_hr' is not defined

Detailed traceback:
  File "&lt;string&gt;", line 1, in &lt;module&gt;</code></pre>
</div>
<p style="text-align: justify;">
In fact, we can even get an warning from python that say something like
“Image size (324649360 pixels) exceeds limit of 244158474 pixels, could
be decompression bomb DOS attack.” This refers to malicious files which
are designed to crash or cause disruption by using up a lot of memory.
</p>
<p>We can get around this by changing the maximum pixel limit as
follows.</p>
<p>To do this, we import Image from the Python Image Library PIL:</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> PIL <span class="im">import</span> Image</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>Image.MAX_IMAGE_PIXELS <span class="op">=</span> <span class="dv">1000000000</span></span></code></pre>
</div>
<p>Let’s try again. Be patient, it might take a moment.</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>img_hr <span class="op">=</span> imread(<span class="st">'fig/rat_brain.jpg'</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>img_hr.shape</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>(17360, 18701, 3)</code></pre>
</div>
<p>Now we can plot the full high-resolution image:</p>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> subplots(figsize<span class="op">=</span>(<span class="dv">25</span>, <span class="dv">15</span>))</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>ax.imshow(img_hr, cmap<span class="op">=</span><span class="st">'gray'</span>)<span class="op">;</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>show()</span></code></pre>
</div>
<figure><img src="fig/03-image_handling-rendered-unnamed-chunk-20-21.png" width="2400" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p style="text-align: justify;">
Although now we can plot this image, it consists of over 300 million
pixels, and we could run into memory problems when trying to process it.
One approach is simply to reduce the resolution. One way to do this is
to import the image using Image from the PIL library that we imported
above. This library gives us more tools to process images, including
decreasing the resolution. It is a rich library with lots of useful
tools. As always, having a look at the <a href="https://pillow.readthedocs.io/en/stable/" class="external-link">documentation</a> and
playing around is recommended!
</p>
<p>We use <code>resize</code> to downsample the image:</p>
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>img_pil <span class="op">=</span> Image.<span class="bu">open</span>(<span class="st">'fig/rat_brain.jpg'</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>img_small <span class="op">=</span> img_pil.resize((<span class="dv">174</span>, <span class="dv">187</span>))</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">type</span>(img_small))</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>&lt;class 'PIL.Image.Image'&gt;</code></pre>
</div>
<p>Plotting should now be quicker.</p>
<div class="codewrapper sourceCode" id="cb30">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> subplots(figsize<span class="op">=</span>(<span class="dv">25</span>, <span class="dv">15</span>))</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>ax.imshow(img_small, cmap<span class="op">=</span><span class="st">'gray'</span>)<span class="op">;</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>show()</span></code></pre>
</div>
<figure><img src="fig/03-image_handling-rendered-unnamed-chunk-22-23.png" width="2400" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p style="text-align: justify;">
With this code, we have resized the image to 174 by 187 pixels. We
should be aware though, that our image is no longer in a Numpy array
form but rather it now has type ‘PIL.Image.Image’. We can, however,
easily convert it back into a Numpy array using <code>array</code>, if
we wish.
</p>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> numpy <span class="im">import</span> array</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>img_numpy <span class="op">=</span> array(img_small)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">type</span>(img_numpy))</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>&lt;class 'numpy.ndarray'&gt;</code></pre>
</div>
<p style="text-align: justify;">
Often, we like to have full resolution images, as resizing causes a loss
of information. An alternative approach to downsampling that is commonly
used is to <em>patch</em> the images, i.e. divide the picture up into
smaller chunks, or patches.
</p>
<p>For this, we can use functionality from the <a href="https://scikit-learn.org/stable/" class="external-link">Scikit-Learn</a> library.</p>
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.feature_extraction.image <span class="im">import</span> extract_patches_2d</span></code></pre>
</div>
<p>‘extract_patches_2d’ is used to extract parts of the image. The shape
of each patch as well as maxiaml number of patches can be specified.</p>
<div class="codewrapper sourceCode" id="cb34">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>patches <span class="op">=</span> extract_patches_2d(img_hr, (<span class="dv">174</span>, <span class="dv">187</span>), max_patches<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>patches.shape</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>(100, 174, 187, 3)</code></pre>
</div>
<p>Note that patching itself can be a memory-intensive task. Extracting
lots and lots of patches might take a long time. To look at the patches
we can use a for loop:</p>
<div class="codewrapper sourceCode" id="cb36">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> subplots(nrows<span class="op">=</span><span class="dv">10</span>, ncols<span class="op">=</span><span class="dv">10</span>, figsize<span class="op">=</span>(<span class="dv">25</span>, <span class="dv">25</span>))</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> ax.flatten()</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> index <span class="kw">in</span> <span class="bu">range</span>(patches.shape[<span class="dv">0</span>]):</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>    ax[index].imshow(patches[index, :, :, :])</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>show()</span></code></pre>
</div>
<figure><img src="fig/03-image_handling-rendered-unnamed-chunk-26-25.png" width="2400" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Now, working with these smaller, individual patches will be much more
managable!</p>
</div>
<div class="section level3">
<h3 id="d-images"><strong>3D Images</strong><a class="anchor" aria-label="anchor" href="#d-images"></a></h3>
<p style="text-align: justify;">
Sometimes we might want to work with 3D images. A good example for this
are MRI scans. These don’t come as ‘csv’ format but in specialised image
formats. One example is <code>nii</code>, the <em>Neuroimaging
Informatics Technology Initiative (NIfTI)</em> open file format. For
these types of images we will need special software. In particular, we
will be using the open source library called <strong>nibabel</strong>.
Documentation for this package is available at <a href="https://nipy.org/nibabel/" class="external-link uri">https://nipy.org/nibabel/</a>.
</p>
<p>As it is not contained in your Python installation by default, it
needs to be installed first.</p>
<p>To install it, please run:</p>
<pre><code>conda install -c conda-forge nibabel</code></pre>
<p>in your command line or terminal if you have an <strong>Anaconda
distribution</strong> of Python.</p>
<p>Alternatively, you can install it using:</p>
<pre><code>pip install nibabel</code></pre>
<p>in your command line or terminal.</p>
<div class="codewrapper sourceCode" id="cb39">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> nibabel <span class="im">as</span> nib</span></code></pre>
</div>
<p>The package is now available for use. If a function comes from that
packege, we call it by referring to the package using <code>nib</code>,
followed by a period and the name of the function:</p>
<div class="codewrapper sourceCode" id="cb40">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>img_3d <span class="op">=</span> nib.load(<span class="st">'fig/brain.nii'</span>)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>img_data <span class="op">=</span> img_3d.get_fdata()</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">type</span>(img_data))</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>&lt;class 'numpy.memmap'&gt;</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb42">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(img_data.shape)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>(256, 256, 124)</code></pre>
</div>
<p style="text-align: justify;">
We can see that this image has three dimensions, and a total of 256 x
256 x 124 volume pixels (or voxels). To visualise our image, we can plot
one slice at a time. Below, we show three different slices, in the
transverse direction (from chin to the top of the head. To access an
image from the transverse direction, you pick a single value from the
third dimension of the image:
</p>
<div class="codewrapper sourceCode" id="cb44">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> subplots(ncols<span class="op">=</span><span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">25</span>, <span class="dv">15</span>))</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>p1 <span class="op">=</span> ax[<span class="dv">0</span>].imshow(img_data[:, :, <span class="dv">60</span>], cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>p2 <span class="op">=</span> ax[<span class="dv">1</span>].imshow(img_data[:, :, <span class="dv">75</span>], cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>p3 <span class="op">=</span> ax[<span class="dv">2</span>].imshow(img_data[:, :, <span class="dv">90</span>], cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>fig.colorbar(p1, ax<span class="op">=</span>ax[<span class="dv">0</span>], shrink<span class="op">=</span><span class="fl">0.4</span>)</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>fig.colorbar(p2, ax<span class="op">=</span>ax[<span class="dv">1</span>], shrink<span class="op">=</span><span class="fl">0.4</span>)</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>fig.colorbar(p3, ax<span class="op">=</span>ax[<span class="dv">2</span>], shrink<span class="op">=</span><span class="fl">0.4</span>)<span class="op">;</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>show()</span></code></pre>
</div>
<figure><img src="fig/03-image_handling-rendered-unnamed-chunk-29-27.png" width="2400" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>These look fairly dark. We can improve the contrast, by adjusting the
intensity range. This requires setting of the keyword arguments
<code>vmin</code> and <code>vmax</code>.</p>
<p style="text-align: justify;">
<code>vmin</code> and <code>vmax</code> define the data range that the
colormap (in our case the ‘grey’ map) covers. By default, the colormap
covers the complete value range of the supplied data. For an image that
will be somewhere between 0 and 255. If we want to brighten up the
darker shades of grey, we can reduce the value of <code>vmax</code>
</p>
<p>Exanding the above code:</p>
<div class="codewrapper sourceCode" id="cb45">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> subplots(ncols<span class="op">=</span><span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">25</span>, <span class="dv">15</span>))</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>p1 <span class="op">=</span> ax[<span class="dv">0</span>].imshow(img_data[:, :, <span class="dv">60</span>], cmap<span class="op">=</span><span class="st">'gray'</span>, vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">150</span>)</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>p2 <span class="op">=</span> ax[<span class="dv">1</span>].imshow(img_data[:, :, <span class="dv">75</span>], cmap<span class="op">=</span><span class="st">'gray'</span>, vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">150</span>)</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>p3 <span class="op">=</span> ax[<span class="dv">2</span>].imshow(img_data[:, :, <span class="dv">90</span>], cmap<span class="op">=</span><span class="st">'gray'</span>, vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">150</span>)</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>fig.colorbar(p1, ax<span class="op">=</span>ax[<span class="dv">0</span>], shrink<span class="op">=</span><span class="fl">0.4</span>)</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>fig.colorbar(p2, ax<span class="op">=</span>ax[<span class="dv">1</span>], shrink<span class="op">=</span><span class="fl">0.4</span>)</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>fig.colorbar(p3, ax<span class="op">=</span>ax[<span class="dv">2</span>], shrink<span class="op">=</span><span class="fl">0.4</span>)<span class="op">;</span></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>show()</span></code></pre>
</div>
<figure><img src="fig/03-image_handling-rendered-unnamed-chunk-30-29.png" width="2400" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>What about the other dimensions? We can also plot coronal and
sagittal slices but note that the respective slices have different pixel
resolution.</p>
<div class="codewrapper sourceCode" id="cb46">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> subplots(nrows<span class="op">=</span><span class="dv">3</span>, ncols<span class="op">=</span><span class="dv">5</span>, figsize<span class="op">=</span>(<span class="dv">26</span>, <span class="dv">18</span>))</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>t1 <span class="op">=</span> ax[<span class="dv">0</span>, <span class="dv">0</span>].imshow(img_data[:, :, <span class="dv">45</span>].T, cmap<span class="op">=</span><span class="st">'gray'</span>, vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">150</span>, origin<span class="op">=</span><span class="st">'lower'</span>)</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>t2 <span class="op">=</span> ax[<span class="dv">0</span>, <span class="dv">1</span>].imshow(img_data[:, :, <span class="dv">60</span>].T, cmap<span class="op">=</span><span class="st">'gray'</span>, vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">150</span>, origin<span class="op">=</span><span class="st">'lower'</span>)</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>t3 <span class="op">=</span> ax[<span class="dv">0</span>, <span class="dv">2</span>].imshow(img_data[:, :, <span class="dv">75</span>].T, cmap<span class="op">=</span><span class="st">'gray'</span>, vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">150</span>, origin<span class="op">=</span><span class="st">'lower'</span>)</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>t4 <span class="op">=</span> ax[<span class="dv">0</span>, <span class="dv">3</span>].imshow(img_data[:, :, <span class="dv">90</span>].T, cmap<span class="op">=</span><span class="st">'gray'</span>, vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">150</span>, origin<span class="op">=</span><span class="st">'lower'</span>)</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>t5 <span class="op">=</span> ax[<span class="dv">0</span>, <span class="dv">4</span>].imshow(img_data[:, :, <span class="dv">105</span>].T, cmap<span class="op">=</span><span class="st">'gray'</span>, vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">150</span>, origin<span class="op">=</span><span class="st">'lower'</span>)</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>c1 <span class="op">=</span> ax[<span class="dv">1</span>, <span class="dv">0</span>].imshow(img_data[:, <span class="dv">50</span>, :].T, cmap<span class="op">=</span><span class="st">'gray'</span>, vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">150</span>, origin<span class="op">=</span><span class="st">'lower'</span>)</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>c2 <span class="op">=</span> ax[<span class="dv">1</span>, <span class="dv">1</span>].imshow(img_data[:, <span class="dv">75</span>, :].T, cmap<span class="op">=</span><span class="st">'gray'</span>, vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">150</span>, origin<span class="op">=</span><span class="st">'lower'</span>)</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>c3 <span class="op">=</span> ax[<span class="dv">1</span>, <span class="dv">2</span>].imshow(img_data[:, <span class="dv">90</span>, :].T, cmap<span class="op">=</span><span class="st">'gray'</span>, vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">150</span>, origin<span class="op">=</span><span class="st">'lower'</span>)</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>c4 <span class="op">=</span> ax[<span class="dv">1</span>, <span class="dv">3</span>].imshow(img_data[:, <span class="dv">105</span>, :].T, cmap<span class="op">=</span><span class="st">'gray'</span>, vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">150</span>, origin<span class="op">=</span><span class="st">'lower'</span>)</span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>c5 <span class="op">=</span> ax[<span class="dv">1</span>, <span class="dv">4</span>].imshow(img_data[:, <span class="dv">120</span>, :].T, cmap<span class="op">=</span><span class="st">'gray'</span>, vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">150</span>, origin<span class="op">=</span><span class="st">'lower'</span>)</span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>s1 <span class="op">=</span> ax[<span class="dv">2</span>, <span class="dv">0</span>].imshow(img_data[<span class="dv">75</span>, :, :].T, cmap<span class="op">=</span><span class="st">'gray'</span>, vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">150</span>, origin<span class="op">=</span><span class="st">'lower'</span>)</span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>s2 <span class="op">=</span> ax[<span class="dv">2</span>, <span class="dv">1</span>].imshow(img_data[<span class="dv">90</span>, :, :].T, cmap<span class="op">=</span><span class="st">'gray'</span>, vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">150</span>, origin<span class="op">=</span><span class="st">'lower'</span>)</span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>s3 <span class="op">=</span> ax[<span class="dv">2</span>, <span class="dv">2</span>].imshow(img_data[<span class="dv">105</span>, :, :].T, cmap<span class="op">=</span><span class="st">'gray'</span>, vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">150</span>, origin<span class="op">=</span><span class="st">'lower'</span>)</span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a>s4 <span class="op">=</span> ax[<span class="dv">2</span>, <span class="dv">3</span>].imshow(img_data[<span class="dv">120</span>, :, :].T, cmap<span class="op">=</span><span class="st">'gray'</span>, vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">150</span>, origin<span class="op">=</span><span class="st">'lower'</span>)</span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a>s5 <span class="op">=</span> ax[<span class="dv">2</span>, <span class="dv">4</span>].imshow(img_data[<span class="dv">135</span>, :, :].T, cmap<span class="op">=</span><span class="st">'gray'</span>, vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">150</span>, origin<span class="op">=</span><span class="st">'lower'</span>)<span class="op">;</span></span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a>show()</span></code></pre>
</div>
<figure><img src="fig/03-image_handling-rendered-unnamed-chunk-31-31.png" width="2496" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Now, we can see all three viewing planes for this 3-dimensional brain
scan!</p>
</div>
</section><section id="exercises-1"><h2 class="section-heading">Exercises</h2>
<hr class="half-width"><div id="challenge1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="end-of-chapter-exercises" class="callout-inner">
<h3 class="callout-title">End of chapter Exercises</h3>
<div class="callout-content">
<p><strong>Assignment</strong> Using the image from the the beginning of
this lesson, “rat_cerebellum.jpg”, do the following tasks:</p>
<ol style="list-style-type: decimal"><li><p>Import the image and display it.</p></li>
<li><p>Show histograms of each of the colour channels and plot the
contributions of each of the RGB colours separately.</p></li>
<li><p>Create three different binary masks using manually determined
thresholds: one for mostly red pixels, one for mostly green pixels, and
one for mostly blue pixels. Note that you can apply conditions that are
either greater than or smaller than a threshold of your choice.</p></li>
<li><p>Plot the three masks and the corresponding masked
images.</p></li>
<li><p>Using your masks, approximate the relative amounts of
synaptophysin, IP3R, and DNA in the image. To do this, you can assume
that the number of red pixels represents synaptophysin, green pixels
represents IP3R and blue pixels represent DNA. The results will vary
depending on the setting of the thresholds. How do different theshold
values change your results?</p></li>
<li><p>Change the resolution of your image to different values. How does
the resolution affect your results?</p></li>
</ol></div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">
  Please check these solutions only after submitting the assignments.
  </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<div class="section level3">
<h3 id="q1">Q1<a class="anchor" aria-label="anchor" href="#q1"></a></h3>
<div class="codewrapper sourceCode" id="cb47">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Import the image</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.image <span class="im">import</span> imread</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>img_task <span class="op">=</span> imread(<span class="st">'fig/rat_cerebellum.jpg'</span>)</span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb48">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Display the image</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.pyplot <span class="im">import</span> subplots</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> subplots(figsize<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">10</span>))</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>ax.imshow(img_task, cmap<span class="op">=</span><span class="st">'gray'</span>)<span class="op">;</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>show()</span></code></pre>
</div>
<figure><img src="fig/03-image_handling-rendered-unnamed-chunk-33-33.png" width="1920" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure></div>
<div class="section level3">
<h3 id="q2">Q2<a class="anchor" aria-label="anchor" href="#q2"></a></h3>
<div class="codewrapper sourceCode" id="cb49">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>red_channel   <span class="op">=</span> img_task[:, :, <span class="dv">0</span>]</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>green_channel <span class="op">=</span> img_task[:, :, <span class="dv">1</span>]</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>blue_channel  <span class="op">=</span> img_task[:, :, <span class="dv">2</span>]</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> subplots(ncols<span class="op">=</span><span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">5</span>))</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].hist(red_channel.flatten(), bins<span class="op">=</span><span class="dv">50</span>)</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_xlabel(<span class="st">"Pixel intensity"</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_xlabel(<span class="st">"Red channel"</span>)</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].hist(green_channel.flatten(), bins<span class="op">=</span><span class="dv">50</span>)</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_xlabel(<span class="st">"Pixel intensity"</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_xlabel(<span class="st">"Green channel"</span>)</span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">2</span>].hist(blue_channel.flatten(), bins<span class="op">=</span><span class="dv">50</span>)</span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">2</span>].set_xlabel(<span class="st">"Pixel intensity"</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">2</span>].set_xlabel(<span class="st">"Blue channel"</span>)<span class="op">;</span></span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>show()</span></code></pre>
</div>
<figure><img src="fig/03-image_handling-rendered-unnamed-chunk-34-35.png" width="1920" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div class="codewrapper sourceCode" id="cb50">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> subplots(ncols<span class="op">=</span><span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">10</span>))</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>imgplot_red   <span class="op">=</span> ax[<span class="dv">0</span>].imshow(red_channel, cmap<span class="op">=</span><span class="st">"Reds"</span>)</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>imgplot_green <span class="op">=</span> ax[<span class="dv">1</span>].imshow(green_channel, cmap<span class="op">=</span><span class="st">"Greens"</span>)</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>imgplot_blue  <span class="op">=</span> ax[<span class="dv">2</span>].imshow(blue_channel, cmap<span class="op">=</span><span class="st">"Blues"</span>)</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>fig.colorbar(imgplot_red,   ax<span class="op">=</span>ax[<span class="dv">0</span>], shrink<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>fig.colorbar(imgplot_green, ax<span class="op">=</span>ax[<span class="dv">1</span>], shrink<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>fig.colorbar(imgplot_blue,  ax<span class="op">=</span>ax[<span class="dv">2</span>], shrink<span class="op">=</span><span class="fl">0.5</span>)<span class="op">;</span></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>show()</span></code></pre>
</div>
<figure><img src="fig/03-image_handling-rendered-unnamed-chunk-35-37.png" width="1920" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure></div>
<div class="section level3">
<h3 id="q3-4">Q3-4<a class="anchor" aria-label="anchor" href="#q3-4"></a></h3>
<div class="codewrapper sourceCode" id="cb51">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>red_mask   <span class="op">=</span> red_channel   <span class="op">&gt;</span> <span class="dv">120</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>green_mask <span class="op">=</span> green_channel <span class="op">&gt;</span> <span class="dv">100</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>blue_mask  <span class="op">=</span> blue_channel  <span class="op">&gt;</span> <span class="dv">100</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>red_masked   <span class="op">=</span> red_channel<span class="op">*</span>red_mask</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>green_masked <span class="op">=</span> green_channel<span class="op">*</span>green_mask</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>blue_masked  <span class="op">=</span> blue_channel<span class="op">*</span>blue_mask</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> subplots(nrows<span class="op">=</span><span class="dv">3</span>, ncols<span class="op">=</span><span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">18</span>, <span class="dv">20</span>))</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>, <span class="dv">0</span>].imshow(red_mask, cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>, <span class="dv">0</span>].set_title(<span class="st">'Red binary mask'</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>, <span class="dv">1</span>].imshow(red_masked, cmap<span class="op">=</span><span class="st">'Reds'</span>)</span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>, <span class="dv">1</span>].set_title(<span class="st">'Masked image'</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>, <span class="dv">0</span>].imshow(green_mask, cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>, <span class="dv">0</span>].set_title(<span class="st">'Green binary mask'</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>, <span class="dv">1</span>].imshow(green_masked, cmap<span class="op">=</span><span class="st">'Greens'</span>)</span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>, <span class="dv">1</span>].set_title(<span class="st">'Masked image'</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">2</span>, <span class="dv">0</span>].imshow(blue_mask, cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">2</span>, <span class="dv">0</span>].set_title(<span class="st">'Blue binary mask'</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">2</span>, <span class="dv">1</span>].imshow(blue_masked, cmap<span class="op">=</span><span class="st">'Blues'</span>)</span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">2</span>, <span class="dv">1</span>].set_title(<span class="st">'Masked image'</span>, fontsize<span class="op">=</span><span class="dv">16</span>)<span class="op">;</span></span>
<span id="cb51-23"><a href="#cb51-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-24"><a href="#cb51-24" aria-hidden="true" tabindex="-1"></a>show()</span></code></pre>
</div>
<figure><img src="fig/03-image_handling-rendered-unnamed-chunk-36-39.png" width="1728" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure></div>
<div class="section level3">
<h3 id="q5">Q5<a class="anchor" aria-label="anchor" href="#q5"></a></h3>
<div class="codewrapper sourceCode" id="cb52">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>total_pixels <span class="op">=</span> img_task.shape[<span class="dv">0</span>]<span class="op">*</span>img_task.shape[<span class="dv">1</span>]</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>red_counts   <span class="op">=</span> <span class="bu">sum</span>(red_mask)</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>green_counts <span class="op">=</span> <span class="bu">sum</span>(green_mask)</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>blue_counts  <span class="op">=</span> <span class="bu">sum</span>(blue_mask)</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Approximately </span><span class="sc">%d</span><span class="st">"</span><span class="op">%</span>(red_counts<span class="op">/</span>total_pixels<span class="op">*</span><span class="dv">100</span>)<span class="op">+</span><span class="st">"</span><span class="sc">% o</span><span class="st">f the image is synaptophysin"</span>)</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>Error <span class="kw">in</span> py_call_impl(<span class="bu">callable</span>, dots$args, dots$keywords): <span class="pp">TypeError</span>: <span class="op">%</span>d <span class="bu">format</span>: a real number <span class="kw">is</span> required, <span class="kw">not</span> numpy.ndarray</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>Detailed traceback:</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>  File <span class="st">"&lt;string&gt;"</span>, line <span class="dv">1</span>, <span class="kw">in</span> <span class="op">&lt;</span>module<span class="op">&gt;</span></span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Approximately </span><span class="sc">%d</span><span class="st">"</span><span class="op">%</span>(green_counts<span class="op">/</span>total_pixels<span class="op">*</span><span class="dv">100</span>)<span class="op">+</span><span class="st">"</span><span class="sc">% o</span><span class="st">f the image is IP3R"</span>)</span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>Error <span class="kw">in</span> py_call_impl(<span class="bu">callable</span>, dots$args, dots$keywords): <span class="pp">TypeError</span>: <span class="op">%</span>d <span class="bu">format</span>: a real number <span class="kw">is</span> required, <span class="kw">not</span> numpy.ndarray</span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>Detailed traceback:</span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>  File <span class="st">"&lt;string&gt;"</span>, line <span class="dv">1</span>, <span class="kw">in</span> <span class="op">&lt;</span>module<span class="op">&gt;</span></span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Approximately </span><span class="sc">%d</span><span class="st">"</span><span class="op">%</span>(blue_counts<span class="op">/</span>total_pixels<span class="op">*</span><span class="dv">100</span>)<span class="op">+</span><span class="st">"</span><span class="sc">% o</span><span class="st">f the image is DNA"</span>) </span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a>Error <span class="kw">in</span> py_call_impl(<span class="bu">callable</span>, dots$args, dots$keywords): <span class="pp">TypeError</span>: <span class="op">%</span>d <span class="bu">format</span>: a real number <span class="kw">is</span> required, <span class="kw">not</span> numpy.ndarray</span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a>Detailed traceback:</span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a>  File <span class="st">"&lt;string&gt;"</span>, line <span class="dv">1</span>, <span class="kw">in</span> <span class="op">&lt;</span>module<span class="op">&gt;</span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="q6">Q6<a class="anchor" aria-label="anchor" href="#q6"></a></h3>
<pre><code>[ad libitum]</code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Keypoints</h3>
<div class="callout-content">
<ul><li>
<code>imread</code> function can interpret many different image
formats.</li>
<li>Masking isolates pixels whose intensity value is below a certain
threshold.</li>
<li>The colour images are comprised of three channels (corresponding to
red, green and blue intensities).</li>
<li>Python Image Library (PIL) helps to set high pixel limit for larger
images.</li>
</ul></div>
</div>
</div>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</section></div> <!-- / div.lesson-content -->
    </main><!-- / main#main-content.main-content --><nav class="bottom-pagination mx-md-4" aria-label="Previous and Next Chapter"><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="02-data_frames_2.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="index.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="02-data_frames_2.html" rel="prev"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous: Data Frames - Part 2</a>
        <a class="chapter-link float-end" href="index.html" rel="next">Next... <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
    </nav></div> <!-- / div.primary-content.col-xs-12 -->
<!-- END:   inst/pkgdown/templates/content-instructor.html-->

      </div><!--/div.row-->
      		<footer class="row footer mx-md-3"><hr><div class="col-md-6">
				<p>All Carpentry lessons are subject to the <a href="https://docs.carpentries.org/topic_folders/policies/code-of-conduct.html" class="external-link">Code of Conduct</a></p>
				<p><a href="https://github.com/carpentries/workbench-template-rmd/edit/main/episodes/03-image_handling.Rmd" class="external-link">Edit on Github</a> | <a href="https://github.com/carpentries/workbench-template-rmd/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a> | <a href="https://github.com/carpentries/workbench-template-rmd/" class="external-link">Source</a></p>
				<p><a href="https://github.com/carpentries/workbench-template-rmd/blob/main/CITATION" class="external-link">Cite</a> | <a href="mailto:team@carpentries.org">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">
        
        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>
        
        <p><a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">Template licensed under CC-BY 4.0</a> by <a href="https://carpentries.org" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper" class="external-link">sandpaper (0.5.1)</a>,
      <a href="https://github.com/carpentries/pegboard" class="external-link">pegboard (0.2.4)</a>,
      and <a href="https://github.com/carpentries/varnish" class="external-link">varnish (0.1.4)</a>.</p>
			</div>
		</footer></div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
			<i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back to top"></i><br><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://carpentries.github.io/workbench-template-rmd/03-image_handling.html",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/0.9-DRAFT-2020_12_08",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, data, lesson, The Carpentries",
  "name": "Image Handling",
  "creativeWorkStatus": "active",
  "url": "https://carpentries.github.io/workbench-template-rmd/03-image_handling.html",
  "identifier": "https://carpentries.github.io/workbench-template-rmd/03-image_handling.html",
  "dateCreated": "2022-06-14",
  "dateModified": "2022-06-23",
  "datePublished": "2022-06-23"
}

  </script><script>
		feather.replace();
	</script><!-- Matomo --><script>
          var _paq = window._paq = window._paq || [];
          /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
          _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
          _paq.push(["setDomains", ["*.lessons.carpentries.org","*.datacarpentry.github.io","*.datacarpentry.org","*.librarycarpentry.github.io","*.librarycarpentry.org","*.swcarpentry.github.io", "*.carpentries.github.io"]]);
          _paq.push(["setDoNotTrack", true]);
          _paq.push(["disableCookies"]);
          _paq.push(['trackPageView']);
          _paq.push(['enableLinkTracking']);
          (function() {
              var u="https://carpentries.matomo.cloud/";
              _paq.push(['setTrackerUrl', u+'matomo.php']);
              _paq.push(['setSiteId', '1']);
              var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
              g.async=true; g.src='https://cdn.matomo.cloud/carpentries.matomo.cloud/matomo.js'; s.parentNode.insertBefore(g,s);
          })();
        </script><!-- End Matomo Code --></body></html><!-- END:   inst/pkgdown/templates/layout.html-->

